<!-- FRONT TEMPLATE: Word Card -->
<div class="card-front">
    <div class="card-container">

        <!-- Audio Button (Top Right) -->
        {{#Audio}}
        <div class="audio-top-right">
            {{Audio}}
        </div>
        {{/Audio}}

        <!-- Header: Word + Dictionary Link + IPA + Part of Speech -->
        <div class="word-header">
            <div class="word-row">
                <span class="word">{{Word}}</span>
                <a href="https://dictionary.cambridge.org/dictionary/english/{{Word}}" class="dict-link"
                    title="Open Cambridge Dictionary">ðŸ“–</a>
            </div>
            <div class="word-meta">
                {{#IPA}}<span class="phonetic" id="ipaFront">{{IPA}}</span>{{/IPA}}
                {{#PartOfSpeech}}<span class="pos">{{PartOfSpeech}}</span>{{/PartOfSpeech}}
            </div>
        </div>

        <!-- Image (if available) -->
        {{#image}}
        <div class="image-container">
            {{image}}
        </div>
        {{/image}}

        <!-- Blank space for meaning (user will think of it) -->
        <div class="meaning-placeholder">
            <span class="placeholder-text">?</span>
        </div>

        <!-- Example Sentence (if available) -->
        {{#ExampleSentence}}
        <div class="example-section">
            <span class="example-text" id="exampleFront">{{ExampleSentence}}</span>
        </div>
        {{/ExampleSentence}}

    </div>
</div>

<!-- Hidden fields for JS -->
<div id="wordValue" style="display:none;">{{Word}}</div>

<script>
// === Utils ===
/**
 * Anki Card Utilities
 */

/**
 * Highlight a word within text (case-insensitive)
 */
function highlightWord(text, word) {
    if (!text || !word) return text;
    const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const regex = new RegExp(`(${escapedWord})`, 'gi');
    return text.replace(regex, '<span class="highlight">$1</span>');
}

/**
 * Apply highlight to example sentence element
 */
function applyHighlight(exampleSelector, word) {
    const exampleEl = document.querySelector(exampleSelector);
    if (exampleEl && word) {
        exampleEl.innerHTML = highlightWord(exampleEl.textContent, word.trim());
    }
}

/**
 * Normalize and apply color to PartOfSpeech element
 * Uses regex patterns to match POS variations with flexible whitespace handling
 */
function applyPosColor() {
    const el = document.querySelector('.pos');
    if (!el) return;

    const pos = el.textContent.trim();

    // POS patterns: [regex, display, cssClass]
    // ^$ ensures exact match, \s* in middle allows flexible spacing
    const posPatterns = [
        // Countable noun: noun [c], n[c], countable, c
        [/^(?:(?:noun|n\.?)\s*\[c\]|countable|c)$/i, 'Noun [C]', 'pos-noun'],
        // Uncountable noun: noun [u], n[u], uncountable, u
        [/^(?:(?:noun|n\.?)\s*\[u\]|uncountable|u)$/i, 'Noun [U]', 'pos-noun'],
        // Basic noun: noun, n, n.
        [/^(?:noun|n\.?)$/i, 'Noun', 'pos-noun'],
        // Verb: verb, v, v.
        [/^(?:verb|v\.?)$/i, 'Verb', 'pos-verb'],
        // Adjective: adjective, adj, adj.
        [/^(?:adjective|adj\.?)$/i, 'Adj', 'pos-adj'],
        // Adverb: adverb, adv, adv.
        [/^(?:adverb|adv\.?)$/i, 'Adv', 'pos-adv'],
        // Preposition: preposition, prep, prep.
        [/^(?:preposition|prep\.?)$/i, 'Prep', 'pos-prep'],
        // Conjunction: conjunction, conj, conj.
        [/^(?:conjunction|conj\.?)$/i, 'Conj', 'pos-conj'],
        // Pronoun: pronoun, pron, pron.
        [/^(?:pronoun|pron\.?)$/i, 'Pron', 'pos-pron']
    ];

    for (var i = 0; i < posPatterns.length; i++) {
        if (posPatterns[i][0].test(pos)) {
            el.textContent = posPatterns[i][1];
            el.classList.add(posPatterns[i][2]);
            break;
        }
    }
}

/**
 * Get the text content of a hidden field element
 */
function getFieldValue(selector) {
    const el = document.querySelector(selector);
    return el ? el.textContent.trim() : '';
}

/**
 * Initialize card when DOM is ready
 */
function onCardReady(callback) {
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', callback);
    } else {
        callback();
    }
}

/**
 * Normalize IPA by removing extra leading/trailing slashes
 * User input: "/hÉ™ËˆloÊŠ/" or "hÉ™ËˆloÊŠ" or "//hÉ™ËˆloÊŠ//" â†’ display: "/hÉ™ËˆloÊŠ/"
 */
function normalizeIPA(selector) {
    var el = document.querySelector(selector);
    if (!el) return;

    var text = el.textContent.trim();
    // Remove all leading and trailing slashes
    var ipa = text.replace(/^\/+|\/+$/g, '');
    // Only update if there's content
    if (ipa) {
        el.textContent = '/' + ipa + '/';
    }
}


// === Front Logic ===
/**
 * Front Card Logic
 */

onCardReady(function() {
  // Apply color to PartOfSpeech
  applyPosColor();
  
  // Normalize IPA (remove extra slashes)
  normalizeIPA('#ipaFront');
  
  // Highlight word in example on front
  var word = getFieldValue('#wordValue');
  if (word) {
    applyHighlight('#exampleFront', word);
  }
});

</script>